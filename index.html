<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Proposal Generator</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, #ffcce0, #ff99cc);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  .container {
    width: 100%;
    max-width: 900px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    width: 100%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  h1, h2, h3 {
    color: #ff3366;
    text-align: center;
    margin-bottom: 20px;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  h2 {
    font-size: 1.8rem;
  }

  h3 {
    font-size: 1.4rem;
    color: #cc0066;
  }

  p {
    color: #555;
    margin-bottom: 15px;
    line-height: 1.5;
  }

  .header-section {
    text-align: center;
    padding-bottom: 20px;
    border-bottom: 2px dashed #ff99cc;
  }

  .creator-note {
    font-size: 0.9rem;
    color: #777;
    text-align: center;
    margin-top: 10px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #ff3366;
  }

  input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #ffcce0;
    border-radius: 10px;
    font-size: 1rem;
    transition: border-color 0.3s;
  }

  input:focus {
    outline: none;
    border-color: #ff3366;
  }

  .phone-input {
    display: flex;
    align-items: center;
  }

  .phone-input span {
    padding: 12px 15px;
    background: #f0f0f0;
    border: 2px solid #ffcce0;
    border-right: none;
    border-radius: 10px 0 0 10px;
    color: #555;
  }

  .phone-input input {
    border-radius: 0 10px 10px 0;
  }

  .image-upload-container {
    border: 2px dashed #ff99cc;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .image-upload-container:hover {
    background: rgba(255, 204, 224, 0.1);
  }

  .upload-icon {
    font-size: 3rem;
    color: #ff3366;
    margin-bottom: 10px;
  }

  .uploaded-image {
    max-width: 200px;
    max-height: 200px;
    border-radius: 10px;
    margin-top: 15px;
    display: none;
    border: 3px solid #ff99cc;
  }

  .btn {
    padding: 14px 30px;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    display: block;
    margin: 20px auto;
    width: 100%;
    max-width: 300px;
  }

  .btn-primary {
    background: linear-gradient(to right, #ff3366, #ff6699);
    color: white;
  }

  .btn-primary:hover {
    background: linear-gradient(to right, #ff0066, #ff3385);
    box-shadow: 0 5px 15px rgba(255, 51, 102, 0.3);
  }

  .btn-secondary {
    background: #f0f0f0;
    color: #333;
  }

  .btn-secondary:hover {
    background: #e0e0e0;
  }

  .btn-gpay {
    background: linear-gradient(to right, #4285f4, #34a853);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .btn-gpay:hover {
    background: linear-gradient(to right, #3367d6, #2e8b57);
    box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
  }

  .gpay-icon {
    font-size: 1.3rem;
  }

  .hidden {
    display: none;
  }

  .link-container {
    background: #fff5f8;
    border: 2px solid #ffcce0;
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    word-break: break-all;
  }

  .link-url {
    font-size: 1.1rem;
    color: #ff3366;
    font-weight: bold;
  }

  .proposal-section {
    text-align: center;
  }

  .options {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 30px 0;
    flex-wrap: wrap;
  }

  .btn-yes {
    background: linear-gradient(to right, #00cc66, #33cc99);
    color: white;
    padding: 15px 40px;
    font-size: 1.3rem;
  }

  .btn-yes:hover {
    background: linear-gradient(to right, #00b359, #2eb88c);
    box-shadow: 0 5px 15px rgba(0, 204, 102, 0.3);
  }

  .btn-no {
    background: linear-gradient(to right, #ff9933, #ffcc66);
    color: white;
    padding: 15px 40px;
    font-size: 1.3rem;
  }

  .btn-no:hover {
    background: linear-gradient(to right, #e68a00, #f0b84d);
    box-shadow: 0 5px 15px rgba(255, 153, 51, 0.3);
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .bill-section {
    background: #f9f9f9;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
  }

  .bill-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed #ddd;
  }

  .bill-total {
    font-weight: bold;
    font-size: 1.2rem;
    color: #ff3366;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 2px solid #ff99cc;
  }

  .items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
  }

  .item-card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
  }

  .item-card:hover {
    transform: translateY(-5px);
  }

  .item-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .timestamp {
    font-size: 0.9rem;
    color: #777;
    text-align: center;
    margin-top: 20px;
  }

  #resultImage {
    max-width: 250px;
    max-height: 250px;
    border-radius: 15px;
    margin: 20px auto;
    display: block;
    border: 4px solid #ff99cc;
  }

  .amount-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .amount-section {
    background: #fff5f8;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .amount-display {
    font-size: 1.8rem;
    color: #ff3366;
    font-weight: bold;
    text-align: center;
    margin: 15px 0;
    padding: 10px;
    background: white;
    border-radius: 10px;
    border: 2px solid #ffcce0;
  }

  .cute-sentence {
    font-size: 1.3rem;
    color: #ff3366;
    font-style: italic;
    text-align: center;
    margin: 20px 0;
    padding: 15px;
    background: linear-gradient(135deg, #fff0f6, #ffe6f2);
    border-radius: 15px;
    border: 2px dashed #ff99cc;
  }

  .couple-image {
    max-width: 250px;
    max-height: 250px;
    border-radius: 15px;
    margin: 20px auto;
    display: block;
    border: 4px solid #ff99cc;
    box-shadow: 0 5px 15px rgba(255, 51, 102, 0.2);
  }

  .upload-label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }

  .upload-label span {
    background: #ff3366;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
  }

  .payment-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .gap-message {
    color: #ff3366;
    text-align: center;
    margin: 15px 0;
    padding: 10px;
    background: #fff0f6;
    border-radius: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="container">
  <!-- First Page: Link Generator -->
  <div class="card" id="generatorPage">
    <div class="header-section">
      <h1>üíù Valentine Proposal Generator</h1>
      <p>Create a magical Valentine's Day proposal with personalized amounts and images!</p>
      <p class="creator-note">Created by Foumi, Devbies</p>
    </div>

    <div class="form-group">
      <label for="yourName">Your Name:</label>
      <input type="text" id="yourName" placeholder="Enter your name">
    </div>

    <div class="form-group">
      <label for="valentineName">Your Valentine's Name:</label>
      <input type="text" id="valentineName" placeholder="Enter your Valentine's name">
    </div>

    <div class="form-group">
      <label for="phoneNumber">Your Phone Number (for GPay):</label>
      <div class="phone-input">
        <span>+91</span>
        <input type="tel" id="phoneNumber" placeholder="Enter your phone number" maxlength="10">
      </div>
    </div>

    <!-- First Amount & Image -->
    <div class="amount-section">
      <h3>üíù First Amount & Image (For "No" option)</h3>
      
      <div class="form-group">
        <label class="upload-label">
          <span>1</span> First Amount (If they say No):
        </label>
        <input type="number" id="amount1" placeholder="Enter amount for No option" max="99999" min="1">
        <div class="amount-display hidden" id="amountDisplay1">‚Çπ0</div>
      </div>
    </div>

    <!-- Second Amount & Images -->
    <div class="amount-section">
      <h3>üíñ Second Amount & Images (For "Yes" option)</h3>
      
      <div class="form-group">
        <label class="upload-label">
          <span>2</span> Second Amount (If they say Yes):
        </label>
        <input type="number" id="amount2" placeholder="Enter amount for Yes option" max="99999" min="1">
        <div class="amount-display hidden" id="amountDisplay2">‚Çπ0</div>
      </div>
    </div>

    <!-- Image Uploads -->
    <div class="form-group">
      <label class="upload-label">
        <span>üì∑</span> Upload Couple Image:
      </label>
      <div class="image-upload-container" id="imageUploadContainer1">
        <div class="upload-icon">üíë</div>
        <p>Upload a cute couple image</p>
        <p><small>Will be shown in the proposal</small></p>
        <input type="file" id="imageInput1" accept="image/*" style="display: none;">
        <img id="uploadedImagePreview1" class="uploaded-image" alt="Couple Image">
      </div>
    </div>

    <div class="form-group">
      <label class="upload-label">
        <span>üì∑</span> gp scanner Image:
      </label>
      <div class="image-upload-container" id="imageUploadContainer2">
        <div class="upload-icon">üéâ</div>
        <p>gp scanner</p>
        <p><small>Will be shown after Yes</small></p>
        <input type="file" id="imageInput2" accept="image/*" style="display: none;">
        <img id="uploadedImagePreview2" class="uploaded-image" alt="Celebration Image">
      </div>
    </div>

    <button class="btn btn-primary" onclick="generateLink()">‚ú® Generate Valentine Link</button>

    <div id="linkSection" class="hidden">
      <h3>Your Valentine Link is Ready! üíù</h3>
      <div class="link-container">
        <p class="link-url" id="generatedLink">https://devbies.github.io/My-Valentine/?from=user&to=valentine</p>
      </div>
      <button class="btn btn-secondary" onclick="copyLink()">Copy Link</button>
      <button class="btn btn-primary" onclick="openProposal()">Open Proposal Page</button>
    </div>
  </div>

  <!-- Proposal Page -->
  <div class="card hidden" id="proposalPage">
    <div class="header-section">
      <h2 id="proposalQuestion">My Love, will you be my Valentine?</h2>
      
      <div class="cute-sentence">
        "Every love story is beautiful, but ours is my favorite. üíñ"
      </div>
      
      <div id="proposalImageContainer"></div>
    </div>

    <div class="options">
      <button class="btn btn-yes" onclick="handleYes()">Yes! üíñ Forever!</button>
      <button class="btn btn-no" onclick="handleNo()" id="noButton">No üòî Maybe Later</button>
    </div>

    <a href="https://www.instagram.com/5hxml._/" target="_blank">
      <p class="creator-note">Made with üíñ by shamil</p>
    </a>

    <p id="noHint" class="hidden" style="color: #ff9933; font-style: italic;">Think about it... Our love story is just beginning! üíï</p>
  </div>

  <!-- Yes Result Page -->
  <div class="card hidden" id="yesResultPage">
    <div class="header-section">
      <h2>üéâ Yay! You Said YES! üíñ</h2>
      <img id="yesResultImage" class="couple-image" alt="Celebration Image">
      <div class="cute-sentence">
        "Love is not about how many days, weeks or months you've been together, it's all about how much you love each other every day."
      </div>
    </div>

    <div class="bill-section">
      <h3>üíù Pay the upcoming bills alsoo</h3>
      <div id="yesBillItems"></div>
      <div class="bill-total">
        Total Love Investment: ‚Çπ<span id="yesTotal">0</span>
      </div>
    </div>

    <div class="gap-message">
      Pay via GPay to celebrate our love! üí∞
    </div>

    <div class="payment-buttons">
      <button class="btn btn-gpay" onclick="openGPay('yes')">
        <span class="gpay-icon">üí∞</span>
        Pay with GPay (Yes Amount)
      </button>
    </div>

    <div class="timestamp">
      üíå Proposal sent at: <span id="yesGeneratedTime"></span><br>
      üíñ Yes accepted at: <span id="yesClickedTime"></span>
    </div>

    <button class="btn btn-primary" onclick="createNewLink()">Create Another Love Story</button>
  </div>

  <!-- No Modal -->
  <div class="modal" id="noModal">
    <div class="modal-content">
      <h2>üíî You said No...</h2>
      <p>But love deserves a second chance! Here's what it'll cost to change my mind:</p>
      
      <!-- <img id="yesResultImage" class="couple-image" alt="Celebration Image"> -->
      <div id="noModalImageContainer"></div>

      <div class="gap-message">
        Pay via GPay to convince you! üí∞
      </div>

      <div class="bill-section">
        <h3>üíù Pay the bills so far</h3>
        <div id="noBillItems"></div>
        <div class="bill-total">
          Total to Win My Heart: ‚Çπ<span id="noTotal">0</span>
        </div>
      </div>

      <div class="payment-buttons">
        <button class="btn btn-gpay" onclick="openGPay('no')">
          <span class="gpay-icon">üí∞</span>
          Pay with GPay (No Amount)
        </button>
      </div>

      <div class="timestamp">
        üíî No clicked at: <span id="noClickedTime"></span>
      </div>

      <div class="payment-buttons">
        <button class="btn btn-primary" onclick="closeModal()">Close</button>
        <button class="btn btn-secondary" onclick="tryAgain()">You regret? Go back</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Global variables
  let generatedTime, yesClickedTime, noClickedTime;
  let firstImageData = null;
  let secondImageData = null;
  let amount1 = 0;
  let amount2 = 0;
  let noClicked = false;
  let userPhone = '';

  // Initialize image uploads
  document.getElementById('imageUploadContainer1').addEventListener('click', function() {
    document.getElementById('imageInput1').click();
  });

  document.getElementById('imageUploadContainer2').addEventListener('click', function() {
    document.getElementById('imageInput2').click();
  });

  document.getElementById('imageInput1').addEventListener('change', function(e) {
    handleImageUpload(e, 'uploadedImagePreview1', 'first');
  });

  document.getElementById('imageInput2').addEventListener('change', function(e) {
    handleImageUpload(e, 'uploadedImagePreview2', 'second');
  });

  // Handle image upload function
  function handleImageUpload(e, previewId, type) {
    const file = e.target.files[0];
    if (!file) return;
    
    // Check file size (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
      alert('File size should be less than 2MB');
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(event) {
      if (type === 'first') {
        firstImageData = event.target.result;
      } else if (type === 'second') {
        secondImageData = event.target.result;
      }
      document.getElementById(previewId).src = event.target.result;
      document.getElementById(previewId).style.display = 'block';
    };
    reader.readAsDataURL(file);
  }

  // Update amount displays
  document.getElementById('amount1').addEventListener('input', function() {
    const enteredAmount = parseInt(this.value) || 0;
    amount1 = enteredAmount;
    document.getElementById('amountDisplay1').textContent = '‚Çπ' + enteredAmount.toLocaleString();
    document.getElementById('amountDisplay1').classList.remove('hidden');
  });

  document.getElementById('amount2').addEventListener('input', function() {
    const enteredAmount = parseInt(this.value) || 0;
    amount2 = enteredAmount;
    document.getElementById('amountDisplay2').textContent = '‚Çπ' + enteredAmount.toLocaleString();
    document.getElementById('amountDisplay2').classList.remove('hidden');
  });

  // Validate phone number
  function validatePhoneNumber(phone) {
    const phoneRegex = /^[6-9]\d{9}$/;
    return phoneRegex.test(phone);
  }

  // Generate the proposal link
  function generateLink() {
    const yourName = document.getElementById('yourName').value.trim();
    const valentineName = document.getElementById('valentineName').value.trim();
    const phone = document.getElementById('phoneNumber').value.trim();
    
    if (!yourName || !valentineName) {
      alert('Please enter both names!');
      return;
    }
    
    if (!phone) {
      alert('Please enter your phone number for GPay!');
      return;
    }
    
    if (!validatePhoneNumber(phone)) {
      alert('Please enter a valid Indian phone number (10 digits starting with 6-9)!');
      return;
    }
    
    if (!amount1 || amount1 < 1) {
      alert('Please enter the first amount (for No option)!');
      return;
    }
    
    if (!amount2 || amount2 < 1) {
      alert('Please enter the second amount (for Yes option)!');
      return;
    }
    
    if (!firstImageData) {
      alert('Please upload a cute couple image!');
      return;
    }
    
    userPhone = phone;
    
    // Store data in localStorage
    localStorage.setItem('valentineData', JSON.stringify({
      from: yourName,
      to: valentineName,
      phone: phone,
      amount1: amount1,
      amount2: amount2,
      firstImage: firstImageData,
      secondImage: secondImageData
    }));
    
    // Generate a unique link
    const baseUrl = window.location.href.split('?')[0];
    const link = `${baseUrl}?from=${encodeURIComponent(yourName)}&to=${encodeURIComponent(valentineName)}`;
    
    document.getElementById('generatedLink').textContent = link;
    document.getElementById('linkSection').classList.remove('hidden');
    
    // Record generation time
    generatedTime = new Date();
  }

  // Copy link to clipboard
  function copyLink() {
    const linkText = document.getElementById('generatedLink').textContent;
    navigator.clipboard.writeText(linkText).then(() => {
      alert('Link copied to clipboard!');
    });
  }

  // Open the proposal page
  function openProposal() {
    document.getElementById('generatorPage').classList.add('hidden');
    document.getElementById('proposalPage').classList.remove('hidden');
    
    // Load data from localStorage
    const data = JSON.parse(localStorage.getItem('valentineData'));
    if (data) {
      document.getElementById('proposalQuestion').textContent = `${data.to}, will you be my Valentine?`;
      amount1 = data.amount1 || 0;
      amount2 = data.amount2 || 0;
      userPhone = data.phone || '';
      
      // Display first uploaded image (couple image)
      const imageContainer = document.getElementById('proposalImageContainer');
      if (data.firstImage) {
        imageContainer.innerHTML = `<img src="${data.firstImage}" class="couple-image" alt="Our Love Story">`;
      }
    }
    
    // Show the hint after a delay
    setTimeout(() => {
      document.getElementById('noHint').classList.remove('hidden');
    }, 2000);
  }

  // Handle Yes response
  function handleYes() {
    yesClickedTime = new Date();
    
    // Get stored data
    const data = JSON.parse(localStorage.getItem('valentineData'));
    
    // Switch to Yes result page
    document.getElementById('proposalPage').classList.add('hidden');
    document.getElementById('yesResultPage').classList.remove('hidden');
    
    // Set times
    document.getElementById('yesGeneratedTime').textContent = generatedTime ? generatedTime.toLocaleString() : new Date().toLocaleString();
    document.getElementById('yesClickedTime').textContent = yesClickedTime.toLocaleString();
    
    // Display second image if available
    if (data && data.secondImage) {
      document.getElementById('yesResultImage').src = data.secondImage;
      document.getElementById('yesResultImage').style.display = 'block';
    }
    
    // Generate bill for Yes response (using amount2)
    generateYesBill();
  }

  // Handle No response
  function handleNo() {
    noClicked = true;
    noClickedTime = new Date();
    document.getElementById('noClickedTime').textContent = noClickedTime.toLocaleString();
    
    // Disable the No button to prevent multiple clicks
    document.getElementById('noButton').disabled = true;
    document.getElementById('noButton').style.opacity = '0.5';
    document.getElementById('noButton').innerHTML = 'Already Clicked üíî';
    
    // Get stored data and show the uploaded image in modal
    const data = JSON.parse(localStorage.getItem('valentineData'));
    const imageContainer = document.getElementById('noModalImageContainer');
    if (data && data.firstImage) {
      imageContainer.innerHTML = `<img src="${data.secondImage}" class="couple-image" alt="Our Love Story">`;
    }
    
    // Generate bill for No response (using amount1)
    generateNoBill();
    
    // Show modal
    document.getElementById('noModal').style.display = 'flex';
    
    // Add beforeunload event to prevent accidental refresh
    window.addEventListener('beforeunload', preventRefresh);
  }

  // Prevent refresh when No is clicked
  function preventRefresh(e) {
    if (noClicked) {
      e.preventDefault();
      e.returnValue = 'Are you sure you want to leave? Your response has been recorded.';
      return e.returnValue;
    }
  }

  // Generate bill items for Yes response based on amount2
  function generateYesBill() {
    const billItems = [
      { name: "Romantic Candlelight Dinner", percentage: 0.25 },
      { name: "Beautiful Rose Bouquet", percentage: 0.15 },
      { name: "Premium Chocolates", percentage: 0.1 },
      { name: "Surprise Gift", percentage: 0.3 },
      { name: "Celebration Cake", percentage: 0.1 },
      { name: "Memory Photo Album", percentage: 0.1 }
    ];
    
    let total = 0;
    let billHTML = '';
    
    billItems.forEach(item => {
      const itemAmount = Math.round(amount2 * item.percentage);
      total += itemAmount;
      billHTML += `
        <div class="bill-item">
          <span>${item.name}</span>
          <span>‚Çπ${itemAmount.toLocaleString()}</span>
        </div>
      `;
    });
    
    document.getElementById('yesBillItems').innerHTML = billHTML;
    document.getElementById('yesTotal').textContent = total.toLocaleString();
  }

  // Generate bill items for No response based on amount1
  function generateNoBill() {
    const billItems = [
      { name: "Apology Flowers", percentage: 0.2 },
      { name: "Sorry Chocolates", percentage: 0.15 },
      { name: "Sweet Treats", percentage: 0.1 },
      { name: "Romantic Card", percentage: 0.05 },
      { name: "Promise Gift", percentage: 0.3 },
      { name: " Dinner", percentage: 0.2 }
    ];
    
    let total = 0;
    let billHTML = '';
    
    billItems.forEach(item => {
      const itemAmount = Math.round(amount1 * item.percentage);
      total += itemAmount;
      billHTML += `
        <div class="bill-item">
          <span>${item.name}</span>
          <span>‚Çπ${itemAmount.toLocaleString()}</span>
        </div>
      `;
    });
    
    document.getElementById('noBillItems').innerHTML = billHTML;
    document.getElementById('noTotal').textContent = total.toLocaleString();
  }

  // Open GPay function
  function openGPay(type) {
    const data = JSON.parse(localStorage.getItem('valentineData'));
    if (!data || !userPhone) {
      alert('Payment information not found. Please create a new link.');
      return;
    }
    
    const amount = type === 'yes' ? amount2 : amount1;
    const message = type === 'yes' 
      ? `Valentine's Celebration for ${data.to} from ${data.from}`
      : `Convince Me Gift for ${data.to} from ${data.from}`;
    
    // Create UPI ID (using the phone number provided)
    const upiId = `${userPhone}@okbizaxis`;
    
    // Create GPay/UPI URL
    const gpayUrl = `tez://upi/pay?pa=${encodeURIComponent(upiId)}&pn=${encodeURIComponent(data.from)}&am=${amount}&tn=${encodeURIComponent(message)}&cu=INR`;
    
    // Try to open GPay
    window.open(gpayUrl, '_blank');
    
    // Fallback to regular UPI link
    setTimeout(() => {
      const fallbackUrl = `upi://pay?pa=${encodeURIComponent(upiId)}&pn=${encodeURIComponent(data.from)}&am=${amount}&tn=${encodeURIComponent(message)}&cu=INR`;
      window.open(fallbackUrl, '_blank');
    }, 300);
  }

  // Close the No modal
  function closeModal() {
    document.getElementById('noModal').style.display = 'none';
  }

  // Try again after No
  function tryAgain() {
    closeModal();
    
    // Re-enable No button
    document.getElementById('noButton').disabled = false;
    document.getElementById('noButton').style.opacity = '1';
    document.getElementById('noButton').innerHTML = 'No üòî Maybe Later';
    
    // Remove refresh prevention
    noClicked = false;
    window.removeEventListener('beforeunload', preventRefresh);
  }

  // Create a new link
  function createNewLink() {
    // Clear form
    document.getElementById('yourName').value = '';
    document.getElementById('valentineName').value = '';
    document.getElementById('phoneNumber').value = '';
    document.getElementById('amount1').value = '';
    document.getElementById('amount2').value = '';
    document.getElementById('uploadedImagePreview1').src = '';
    document.getElementById('uploadedImagePreview1').style.display = 'none';
    document.getElementById('uploadedImagePreview2').src = '';
    document.getElementById('uploadedImagePreview2').style.display = 'none';
    document.getElementById('amountDisplay1').classList.add('hidden');
    document.getElementById('amountDisplay2').classList.add('hidden');
    
    firstImageData = null;
    secondImageData = null;
    amount1 = 0;
    amount2 = 0;
    userPhone = '';
    
    // Show generator page
    document.getElementById('yesResultPage').classList.add('hidden');
    document.getElementById('proposalPage').classList.add('hidden');
    document.getElementById('generatorPage').classList.remove('hidden');
    document.getElementById('linkSection').classList.add('hidden');
    
    // Remove refresh prevention
    noClicked = false;
    window.removeEventListener('beforeunload', preventRefresh);
  }

  // Check if page was opened with query parameters
  window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    const from = urlParams.get('from');
    const to = urlParams.get('to');
    
    if (from && to) {
      // Directly open proposal page if parameters exist
      document.getElementById('generatorPage').classList.add('hidden');
      document.getElementById('proposalPage').classList.remove('hidden');
      
      document.getElementById('proposalQuestion').textContent = `${to}, will you be my Valentine?`;
      
      // Check if there's data in localStorage
      const data = JSON.parse(localStorage.getItem('valentineData'));
      if (data) {
        amount1 = data.amount1 || 0;
        amount2 = data.amount2 || 0;
        userPhone = data.phone || '';
        
        // Display first uploaded image
        if (data.firstImage) {
          const imageContainer = document.getElementById('proposalImageContainer');
          imageContainer.innerHTML = `<img src="${data.firstImage}" class="couple-image" alt="Our Love Story">`;
        }
      } else {
        // If no localStorage data, create minimal data from URL parameters
        localStorage.setItem('valentineData', JSON.stringify({
          from: from,
          to: to,
          phone: '',
          amount1: 0,
          amount2: 0
        }));
      }
      
      // Set generation time
      generatedTime = new Date();
      
      // Show the hint after a delay
      setTimeout(() => {
        document.getElementById('noHint').classList.remove('hidden');
      }, 2000);
    }
  };
</script>
</body>
</html>
